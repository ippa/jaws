var jaws=function(c){var b,e;c.title=function(d){if(d)return b.innerHTML=d;return b.innerHTML};c.unpack=function(){["Sprite","SpriteList","Animation","Viewport","SpriteSheet","Parallax","TileMap","Rect","pressed"].forEach(function(d){if(window[d])c.debug(d+"already exists in global namespace");else window[d]=c[d]})};c.debug=function(d,g){if(e){d+="<br />";e.innerHTML=g?e.innerHTML.toString()+d:d}};c.init=function(){b=document.getElementsByTagName("title")[0];for(var d=c,g=[],j,f=window.location.href.slice(window.location.href.indexOf("?")+
1).split("&"),h=0;h<f.length;h++){j=f[h].split("=");g.push(j[0]);g[j[0]]=j[1]}d.url_parameters=g;e=document.getElementById("jaws-debug");if(c.url_parameters.debug)if(!e){e=document.createElement("div");e.style.cssText="overflow: auto; color: #aaaaaa; width: 300px; height: 150px; margin: 40px auto 0px auto; padding: 5px; border: #444444 1px solid; clear: both; font: 10px verdana; text-align: left;";document.body.appendChild(e)}c.canvas=document.getElementsByTagName("canvas")[0];if(c.canvas)c.context=
c.canvas.getContext("2d");else{c.dom=document.getElementById("canvas");c.dom.style.position="relative"}c.width=c.canvas?c.canvas.width:c.dom.offsetWidth;c.height=c.canvas?c.canvas.height:c.dom.offsetHeigh};c.start=function(d,g){function j(k,o){c.debug(o+"%: "+k,true)}function f(){c.debug("all assets loaded",true);c.gameloop=new c.GameLoop(d.setup,d.update,d.draw,h);c.gameloop.start()}if(d&&c.isFunction(d))d=new d;d||(d=window);var h=g&&g.fps||60;c.init();c.debug("setupInput()",true);c.setupInput();
c.debug("assets.loadAll()",true);c.assets.length()>0?c.assets.loadAll({loading:j,loaded:f}):f()};c.switchGameState=function(d){c.gameloop.stop();c.clearKeyCallbacks();if(c.isFunction(d))d=new d;c.previous_game_state=d;c.game_state=d;c.gameloop=new c.GameLoop(d.setup,d.update,d.draw,c.gameloop.fps);c.gameloop.start()};c.clear=function(){c.context.clearRect(0,0,c.width,c.height)};c.isImage=function(d){return Object.prototype.toString.call(d)==="[object HTMLImageElement]"};c.isCanvas=function(d){return Object.prototype.toString.call(d)===
"[object HTMLCanvasElement]"};c.isDrawable=function(d){return c.isImage(d)||c.isCanvas(d)};c.isString=function(d){return typeof d=="string"};c.isArray=function(d){return d.constructor.toString().indexOf("Array")!=-1};c.isFunction=function(d){return Object.prototype.toString.call(d)==="[object Function]"};c.combinations=function(d,g){for(var j=function(p){return d[p]},f=[],h=Array(g),k=0;k<g;k++)h[k]=k;k=g-1;for(var o=d.length;0<=k;o=d.length){for(f.push(h.map(j));0<=k&&h[k]==o-1;){k--;o--}if(0<=k){h[k]+=
1;for(k=k+1;k<g;k++)h[k]=h[k-1]+1;k=g-1}}return f};return c}(jaws||{});
jaws=function(c){var b={},e=[],d=[],g=[];c.setupInput=function(){var f=[];f[8]="backspace";f[9]="tab";f[13]="enter";f[16]="shift";f[17]="ctrl";f[18]="alt";f[19]="pause";f[20]="capslock";f[27]="esc";f[32]="space";f[33]="pageup";f[34]="pagedown";f[35]="end";f[36]="home";f[37]="left";f[38]="up";f[39]="right";f[40]="down";f[45]="insert";f[46]="delete";f[91]="leftwindowkey";f[92]="rightwindowkey";f[93]="selectkey";f[106]="multiply";f[107]="add";f[109]="subtract";f[110]="decimalpoint";f[111]="divide";f[144]=
"numlock";f[145]="scrollock";f[186]="semicolon";f[187]="equalsign";f[188]="comma";f[189]="dash";f[190]="period";f[191]="forwardslash";f[192]="graveaccent";f[219]="openbracket";f[220]="backslash";f[221]="closebracket";f[222]="singlequote";for(var h=["numpad1","numpad2","numpad3","numpad4","numpad5","numpad6","numpad7","numpad8","numpad9"],k=["f1","f2","f3","f4","f5","f6","f7","f8","f9"],o=["1","2","3","4","5","6","7","8","9"],p=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r",
"s","t","u","v","w","x","y","z"],l=0;o[l];l++)f[48+l]=o[l];for(l=0;p[l];l++)f[65+l]=p[l];for(l=0;h[l];l++)f[96+l]=h[l];for(l=0;k[l];l++)f[112+l]=k[l];e=f;window.onkeydown=function(m){event=m?m:window.event;var n=e[event.keyCode];b[n]=true;if(d[n]){d[n]();m.preventDefault()}j[n]&&m.preventDefault()};window.onkeyup=function(m){event=m?m:window.event;var n=e[event.keyCode];b[n]=false;if(g[n]){g[n]();m.preventDefault()}j[n]&&m.preventDefault()};window.onkeypress=function(){}};var j=[];c.preventDefaultKeys=
function(f){f.forEach(function(h){j[h]=true})};c.pressed=function(f){return b[f]};c.on_keydown=function(f,h){if(c.isArray(f))for(var k=0;f[k];k++)d[f[k]]=h;else d[f]=h};c.on_keyup=function(f,h){if(c.isArray(f))for(var k=0;f[k];k++)g[f[k]]=h;else g[f]=h};c.clearKeyCallbacks=function(){g=[];d=[]};return c}(jaws||{});
jaws=function(c){function b(e){var d=document.createElement("canvas");d.width=e.width;d.height=e.height;d.getContext("2d").drawImage(e,0,0,e.width,e.height);return d}c.assets=new function(){this.list=[];this.data=[];this.fuchia_to_transparent=this.image_to_canvas=true;this.woff="mooo!";this.file_type={};this.file_type.wav="audio";this.file_type.mp3="audio";this.file_type.ogg="audio";this.file_type.png="image";this.file_type.jpg="image";this.file_type.jpeg="image";this.file_type.bmp="image";var e=
this;this.length=function(){return this.list.length};this.add=function(d){this.list.push({src:d});return this};this.get=function(d){return c.isArray(d)?d.map(function(g){return e.data[g]}):this.data[d]};this.getPostfix=function(d){postfix_regexp=/\.([a-zA-Z]+)/;return postfix_regexp.exec(d)[1]};this.getType=function(d){d=this.getPostfix(d);return this.file_type[d]?this.file_type[d]:d};this.loadAll=function(d){this.loadedCount=0;if(d){this.loaded_callback=d.loaded;this.loading_callback=d.loading}for(i=
0;this.list[i];i++){d=this.list[i];switch(this.getType(d.src)){case "image":var g=d.src+"?"+parseInt(Math.random()*1E7);d.image=new Image;d.image.asset=d;d.image.onload=this.imageLoaded;d.image.src=g;break;case "audio":g=d.src+"?"+parseInt(Math.random()*1E7);d.audio=new Audio(g);d.audio.asset=d;this.data[d.src]=d.audio;d.audio.addEventListener("canplay",this.audioLoaded,false);d.audio.load();break;default:g=d.src+"?"+parseInt(Math.random()*1E7);var j=new XMLHttpRequest;j.open("GET",g,false);j.send(null);
if(j.status==200){this.data[d.src]=this.parseAsset(d.src,j.responseText);this.itemLoaded(d.src)}}}};this.parseAsset=function(d,g){switch(this.getType(d)){case "json":return JSON.parse(g);default:return g}};this.itemLoaded=function(d){this.loadedCount++;var g=parseInt(this.loadedCount/this.list.length*100);this.loading_callback&&this.loading_callback(d,g);this.loaded_callback&&g==100&&this.loaded_callback()};this.imageLoaded=function(){var d=this.asset,g=e.image_to_canvas?b(d.image):d.image;if(e.fuchia_to_transparent&&
e.getPostfix(d.src)=="bmp"){g=g;canvas=c.isImage(g)?b(g):g;g=canvas.getContext("2d");for(var j=g.getImageData(0,0,canvas.width,canvas.height),f=j.data,h=0;h<f.length;h+=4)if(f[h]==255&&f[h+1]==0&&f[h+2]==255)f[h+3]=0;g.putImageData(j,0,0);g=canvas}e.data[d.src]=g;e.itemLoaded(d.src)};this.audioLoaded=function(){var d=this.asset;e.data[d.src]=d.audio;d.audio.removeEventListener("canplay",e.audioLoaded,false);e.itemLoaded(d.src)}};return c}(jaws||{});
jaws=function(c){c.GameLoop=function(b,e,d,g){this.fps=this.tick_duration=this.ticks=0;var j,f=false,h=this;this.start=function(){c.debug("gameloop start",true);this.current_tick=(new Date).getTime();this.last_tick=(new Date).getTime();b&&b();j=setInterval(this.loop,1E3/g);c.debug("gameloop loop",true)};this.loop=function(){h.current_tick=(new Date).getTime();h.tick_duration=h.current_tick-h.last_tick;h.fps=parseInt(1E3/h.tick_duration);if(!f){e&&e();d&&d();h.ticks++}h.last_tick=h.current_tick};this.pause=
function(){f=true};this.unpause=function(){f=false};this.stop=function(){j&&clearInterval(j)}};return c}(jaws||{});
jaws=function(c){c.Rect=function(b,e,d,g){this.x=b;this.y=e;this.width=d;this.height=g;this.right=b+d;this.bottom=e+g};c.Rect.move=function(b,e){this.x+=b;this.y+=e;this.right+=b;this.bottom+=e};c.Rect.moveTo=function(b,e){this.x=b;this.y=e;this.right=this.x+this.width;this.bottom=this.y+this.height};c.Rect.prototype.draw=function(){c.context.strokeStyle="red";c.context.strokeRect(this.x,this.y,this.width,this.height)};c.Rect.prototype.collidePoint=function(b,e){return b>=this.x&&b<=this.right&&e>=
this.y&&e<=this.bottom};c.Rect.prototype.collideRect=function(b){return(this.x>=b.x&&this.x<=b.right||b.x>=this.x&&b.x<=this.right)&&(this.y>=b.y&&this.y<=b.bottom||b.y>=this.y&&b.y<=this.bottom)};c.Rect.prototype.collideRightSide=function(b){return this.right>=b.x&&this.x<b.x};c.Rect.prototype.collideLeftSide=function(b){return this.x>b.x&&this.x<=b.right};c.Rect.prototype.collideTopSide=function(b){return this.y>=b.y&&this.y<=b.bottom};c.Rect.prototype.collideBottomSide=function(b){return this.bottom>=
b.y&&this.y<b.y};c.Rect.prototype.toString=function(){return"[Rect "+this.x+", "+this.y+","+this.width+","+this.height+"]"};return c}(jaws||{});
jaws=function(c){c.Sprite=function(b){this.options=b;this.x=b.x||0;this.y=b.y||0;this.alpha=b.alpha||1;this.context=b.context||c.context;this.anchor_x=b.anchor_x||0;this.anchor_y=b.anchor_y||0;this.angle=b.angle||0;this.flipped=b.flipped||false;b.image&&this.setImage(b.image);b.anchor&&this.setAnchor(b.anchor);this.setScale(b.scale);this.context||this.createDiv()};c.Sprite.prototype.flip=function(){this.flipped=this.flipped?false:true};c.Sprite.prototype.move=function(b,e){this.x+=b;this.y+=e};c.Sprite.prototype.moveTo=
function(b,e){this.x=b;this.y=e};c.Sprite.prototype.calcBorderOffsets=function(){if(this.image){this.width=this.image.width*this.scale;this.height=this.image.height*this.scale;this.left_offset=this.width*this.anchor_x;this.top_offset=this.height*this.anchor_y}};c.Sprite.prototype.setImage=function(b){this.image=c.isDrawable(b)?b:c.assets.data[b];this.calcBorderOffsets()};c.Sprite.prototype.setScale=function(b){this.scale=b||1;this.calcBorderOffsets()};c.Sprite.prototype.toRect=function(){if(this.image)return new c.Rect(this.x-
this.left_offset,this.y-this.top_offset,this.width,this.height)};c.Sprite.prototype.createDiv=function(){this.div=document.createElement("div");this.div.style.position="absolute";if(this.image){this.div.style.width=this.image.width+"px";this.div.style.height=this.image.height+"px";this.div.style.backgroundImage="url("+this.image.src+")"}c.dom&&c.dom.appendChild(this.div);this.updateDiv()};c.Sprite.prototype.updateDiv=function(){this.div.style.left=this.x+"px";this.div.style.top=this.y+"px";var b=
"";b+="rotate("+this.angle+"deg) ";if(this.flipped)b+="scale(-"+this.scale+","+this.scale+")";else if(this.scale!=1)b+="scale("+this.scale+")";this.div.style.MozTransform=b;this.div.style.WebkitTransform=b;this.div.style.transform=b};c.Sprite.prototype.draw=function(){if(c.dom)return this.updateDiv();if(this.image){this.context.save();this.context.translate(this.x,this.y);this.angle&&c.context.rotate(this.angle*Math.PI/180);this.flipped&&this.context.scale(-1,1);this.context.globalAlpha=this.alpha;
this.context.translate(-this.left_offset,-this.top_offset);this.context.drawImage(this.image,0,0,this.width,this.height);this.context.restore();return this}};c.Sprite.prototype.asCanvasContext=function(){var b=document.createElement("canvas");b.width=this.width;b.height=this.height;b=b.getContext("2d");b.mozImageSmoothingEnabled=c.context.mozImageSmoothingEnabled;b.drawImage(this.image,0,0,this.width,this.height);return b};c.Sprite.prototype.rotate=function(b){this.angle+=b;return this};c.Sprite.prototype.setAnchor=
function(b){if(a={top_left:[0,0],left_top:[0,0],center_left:[0,0.5],left_center:[0,0.5],bottom_left:[0,1],left_bottom:[0,1],top_center:[0.5,0],center_top:[0.5,0],center_center:[0.5,0.5],center:[0.5,0.5],bottom_center:[0.5,1],center_bottom:[0.5,1],top_right:[1,0],right_top:[1,0],center_right:[1,0.5],right_center:[1,0.5],bottom_right:[1,1],right_bottom:[1,1]}[b]){this.anchor_x=a[0];this.anchor_y=a[1];this.calcBorderOffsets()}return this};c.Sprite.prototype.toString=function(){return"[Sprite "+this.x+
", "+this.y+","+this.width+","+this.height+"]"};return c}(jaws||{});
jaws=function(c){c.SpriteList=function(){};c.SpriteList.prototype=[];c.SpriteList.prototype.draw=function(){for(i=0;this[i];i++)this[i].draw()};c.SpriteList.prototype.drawIf=function(b){for(i=0;this[i];i++)b(this[i])&&this[i].draw()};c.SpriteList.prototype.update=function(){for(i=0;this[i];i++)this[i].update()};c.SpriteList.prototype.updateIf=function(b){for(i=0;this[i];i++)b(this[i])&&this[i].update()};c.SpriteList.prototype.deleteIf=function(b){for(var e=0;this[e];e++)b(this[e])&&this.splice(e,
1)};return c}(jaws||{});
jaws=function(c){function b(e,d,g,j,f){var h=document.createElement("canvas");h.width=j;h.height=f;h.getContext("2d").drawImage(e,d,g,j,f,0,0,h.width,h.height);return h}c.SpriteSheet=function(e){this.image=c.isDrawable(e.image)?e.image:c.assets.data[e.image];this.orientation=e.orientation||"right";this.frame_size=e.frame_size||[32,32];this.frames=[];for(e=0;e<this.image.width;e+=this.frame_size[0])for(var d=0;d<this.image.height;d+=this.frame_size[1])this.frames.push(b(this.image,e,d,this.frame_size[0],
this.frame_size[1]))};return c}(jaws||{});
jaws=function(c){c.Parallax=function(b){this.scale=b.scale||1;this.repeat_x=b.repeat_x;this.repeat_y=b.repeat_y;this.camera_x=b.camera_x||0;this.camera_y=b.camera_y||0;this.layers=[]};c.Parallax.prototype.draw=function(){for(var b,e,d,g=0;g<this.layers.length;g++){b=this.layers[g];e=b.x;d=b.y;b.x=-(this.camera_x/b.damping);for(b.y=-(this.camera_y/b.damping);this.repeat_x&&b.x>0;)b.x-=b.width;for(;this.repeat_y&&b.y>0;)b.y-=b.width;for(;this.repeat_x&&b.x<c.width;){for(;this.repeat_y&&b.y<c.height;){b.draw();
b.y+=b.height}b.y=d;b.draw();b.x+=b.width-1}for(;b.repeat_y&&!b.repeat_x&&b.y<c.height;){b.draw();b.y+=b.height}b.x=e}};c.Parallax.prototype.addLayer=function(b){b=new c.ParallaxLayer(b);b.scale(this.scale);this.layers.push(b)};c.ParallaxLayer=function(b){this.damping=b.damping||0;c.Sprite.call(this,b)};c.ParallaxLayer.prototype=c.Sprite.prototype;return c}(jaws||{});
jaws=function(c){c.Animation=function(b){this.options=b;this.frames=b.frames||[];this.frame_duration=b.frame_duration||100;this.index=b.index||0;this.loop=b.loop||1;this.bounce=b.bounce||0;this.frame_direction=1;if(b.sprite_sheet){var e=c.isImage(b.sprite_sheet)?b.sprite_sheet:c.assets.get(b.sprite_sheet);this.frames=(new c.SpriteSheet({image:e,frame_size:b.frame_size})).frames}this.current_tick=(new Date).getTime();this.last_tick=(new Date).getTime();this.sum_tick=0};c.Animation.prototype.update=
function(){this.current_tick=(new Date).getTime();this.sum_tick+=this.current_tick-this.last_tick;this.last_tick=this.current_tick;if(this.sum_tick>this.frame_duration){this.index+=this.frame_direction;this.sum_tick=0}if(this.index>=this.frames.length||this.index<=0)if(this.bounce){this.frame_direction=-this.frame_direction;this.index+=this.frame_direction*2}else if(this.loop)this.index=0;return this};c.Animation.prototype.slice=function(b,e){var d={};d.frame_duration=this.frame_duration;d.loop=this.loop;
d.bounce=this.bounce;d.frame_direction=this.frame_direction;d.frames=this.frames.slice().slice(b,e);return new c.Animation(d)};c.Animation.prototype.next=function(){this.update();return this.frames[this.index]};c.Animation.prototype.currentFrame=function(){return this.frames[this.index]};return c}(jaws||{});
jaws=function(c){c.Viewport=function(b){this.options=b;this.context=b.context||c.context;this.width=b.width||c.width;this.height=b.height||c.height;this.max_x=b.max_x||c.width;this.max_y=b.max_y||c.height;this.verifyPosition=function(){var e=this.max_x-this.width;if(this.x<0)this.x=0;if(this.x>e)this.x=e;e=this.max_y-this.height;if(this.y<0)this.y=0;if(this.y>e)this.y=e};this.move=function(e,d){e&&(this.x+=e);d&&(this.y+=d);this.verifyPosition()};this.moveTo=function(e,d){if(e!=undefined)this.x=e;
if(d!=undefined)this.y=d;this.verifyPosition()};this.isOutside=function(e){return!this.isInside(e)};this.isInside=function(e){return e.x>=this.x&&e.x<=this.x+this.width&&e.y>=this.y&&e.y<=this.y+this.height};this.centerAround=function(e){this.x=e.x-this.width/2;this.y=e.y-this.height/2;this.verifyPosition()};this.apply=function(e){this.context.save();this.context.translate(-this.x,-this.y);e();this.context.restore()};this.moveTo(b.x||0,b.y||0)};return c}(jaws||{});
jaws=function(c){c.TileMap=function(b){this.cell_size=b.cell_size||[32,32];this.size=b.size;this.cells=Array(this.size[0]);for(b=0;b<this.size[0];b++)this.cells[b]=Array(this.size[1])};c.TileMap.prototype.push=function(b){if(c.isArray(b)){for(var e=0;e<b.length;e++)this.push(b[e]);return b}if(b.toRect)return this.pushAsRect(b,b.toRect());else{e=parseInt(b.x/this.cell_size[0]);var d=parseInt(b.y/this.cell_size[1]);return this.pushToCell(e,d,b)}};c.TileMap.prototype.pushAsRect=function(b,e){var d=parseInt(e.x/
this.cell_size[0]),g=parseInt((e.right-1)/this.cell_size[0]);for(d=d;d<=g;d++){var j=parseInt(e.y/this.cell_size[1]),f=parseInt((e.bottom-1)/this.cell_size[1]);for(j=j;j<=f;j++)this.pushToCell(d,j,b)}return b};c.TileMap.prototype.pushToCell=function(b,e,d){this.cells[b][e]=(current_obj=this.cells[b][e])?[current_obj,d]:d;return this.cells[b][e]};c.TileMap.prototype.at=function(b,e){var d=parseInt(b/this.cell_size[0]),g=parseInt(e/this.cell_size[1]);return this.cells[d][g]};c.TileMap.prototype.atRect=
function(b){var e=[],d=parseInt(b.x/this.cell_size[0]),g=parseInt(b.right/this.cell_size[0]);for(d=d;d<=g;d++){var j=parseInt(b.y/this.cell_size[1]),f=parseInt(b.bottom/this.cell_size[1]);for(j=j;j<=f;j++){var h=this.cells[d][j];if(h)if(c.isArray(h))h.forEach(function(k){e.indexOf(k)==-1&&e.push(k)});else e.indexOf(h)==-1&&e.push(h)}}return e};c.TileMap.prototype.cell=function(b,e){return this.cells[b][e]};return c}(jaws||{});
