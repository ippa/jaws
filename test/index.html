<!DOCTYPE html> 
<html>
<head>
  <script src="../jaws.js" type="text/javascript"></script>
  <script src="qunit.js" type="text/javascript"></script>
  <link href="qunit.css" rel="stylesheet" type="text/css" />

  <script type="text/javascript">
    test("Properties should exist", function() {
      ok(jaws, "window.jaws")
      ok(jaws.Animation, "jaws.Animation")
      ok(jaws.Sprite, "jaws.Sprite")
      ok(jaws.SpriteSheet, "jaws.SpriteSheet")
      ok(jaws.Rect, "jaws.Rect")
    })

    test("Rect", function() {
      rect1 = new jaws.Rect(0,0,10,10)
      rect2 = new jaws.Rect(5,5,10,10)
      rect3 = new jaws.Rect(2,2,10,10)
      rect4 = new jaws.Rect(11,11,10,10)  // This won't collide with anything

      ok(rect1.collideRect(rect2), "collideRect()")
      ok(rect3.collideRect(rect1), "collideRect()")
      ok(rect3.collideRect(rect2), "collideRect()")
      ok(!rect4.collideRect(rect1), "collideRect()")
    })

    test("isSomething() helpers", function() {
      a_function = function() {}
      a_string = "a string"
      an_image = new Image()
      an_array = [1,2,3]
      a_canvas = document.createElement("canvas")

      same(jaws.isString(a_string), true, "isString()")
      same(jaws.isFunction(a_function), true, "isFunction()")
      same(jaws.isArray(an_array), true, "isArray()")
      same(jaws.isImage(an_image), true, "isImage()")
      same(jaws.isDrawable(an_image), true, "isDrawable()")

      // Test some negatives too
      same(jaws.isFunction(an_array), false, "isFunction() should fail")
      same(jaws.isArray(a_string), false, "isArray() should fail")
      same(jaws.isString(an_array), false, "isString() should fail")
      same(jaws.isImage(an_array), false, "isImage() should fail")
    })
    
    test("image assets", function() {
      var assets_loaded = 0
      jaws.assets.add("droid_11x15.png")
      jaws.assets.add("rect.png")
      jaws.assets.add("laser.wav")
      jaws.assets.add("gamedata.json")
      jaws.assets.loadAll({loaded: loaded})
      stop()
      function loaded() {
        ok(1, "loaded was called")
        ok(jaws.assets.get("droid_11x15.png"), "image loaded")
        ok(jaws.assets.get("laser.wav"), "audio loaded")
        ok(jaws.assets.get("gamedata.json"), "json loaded")

        ok(jaws.isImage(jaws.assets.get("droid_11x15.png")), "png loaded as Image")
        same(jaws.assets.get("gamedata.json").type, "Troll", "jsondata got parsed into an object")
        same(jaws.assets.get("gamedata.json").mode, "angry", "jsondata got parsed into an object")
        
        asset_depending_tests()
        start()
      }
    });

  // Various test that need to wait some before assets are loaded
  function asset_depending_tests() {
    
    test("Sprite", function() {
      sprite = new jaws.Sprite({image: "rect.png", x:0, y:0})
      equal(sprite.width, 20, "sprite.width")  
      equal(sprite.height, 20, "sprite.height")
      
      sprite.scale = 2
      equal(sprite.width, 40, "sprite.width after scaling x2")
      equal(sprite.height, 40, "sprite.height after scaling x2")
      same(sprite.rect, new jaws.Rect(0,0,40,40), "sprite.rect")

      sprite.center("top_left")
      equal(sprite.x, sprite.left, "sprite.x == sprite.left when center is top_left")
      equal(sprite.y, sprite.top, "sprite.y == sprite.top when center is top_left")
      
      sprite.center("bottom_right")
      equal(sprite.x, sprite.right, "sprite.x == sprite.right when center is bottom_right")
      equal(sprite.y, sprite.bottom, "sprite.y == sprite.bottom when center is bottom_right")
    })
    
    test("Viewport", function() {
      viewport = new jaws.Viewport({max_x: 1000, max_y: 1000, width: 50, height: 40})
      sprite = new jaws.Sprite({image: "rect.png", x:30, y:40})
      
      equal(viewport.x, 0, "viewport.x defaults to 0")
      equal(viewport.y, 0, "viewport.y defaults to 0")

      viewport.x = 1111
      equal(viewport.x, 950, "viewport.x setter will respect max_x and width")
      viewport.x = -10
      equal(viewport.x, 0, "viewport.x setter won't go negative")

      viewport.y = 1111
      equal(viewport.y, 960, "viewport.x setter will respect max_y and height")

      viewport.centerAround(sprite)
      equal(viewport.x, 5, "centerAround will center viewport around given sprite or 'object with x/y'")
      equal(viewport.y, 20, "centerAround will center viewport around given sprite or 'object with x/y'")

      viewport.x = 0
      viewport.y = 0
      sprite.x = 55
      sprite.y = 0
      equal(viewport.isInside(sprite), false, "isInside should return false")
      equal(viewport.isOutside(sprite), true, "isOutside should return true")

      sprite.x = 49
      equal(viewport.isInside(sprite), true, "isInside should return true") 
    })

    test("SpriteSheet", function() {
      sprite_sheet = new jaws.SpriteSheet( {image: "droid_11x15.png", frame_size: [11,15]} )

      ok(jaws.assets.get("droid_11x15.png"), "asset available")
      same(jaws.assets.get("droid_11x15.png").toString(), "[object HTMLImageElement]",  "is image")
      same(sprite_sheet.frame_size, [11,15], "frame_size")
      equal(sprite_sheet.frames[0].toString(), "[object HTMLCanvasElement]", "one frame is canvas")
      equal(sprite_sheet.frames.length, 14,"correct number of frames")
      equal(sprite_sheet.frames.length, sprite_sheet.length, "frames.length == length")
    })

    test("Animation", function() {
      sprite_sheet = new jaws.SpriteSheet( {image: "droid_11x15.png", frame_size: [11,15]} )
      animation = new jaws.Animation({frames: sprite_sheet.frames})
      animation2 = animation.slice(0,5) 
      animation3 = animation.slice(0,2) 

      ok(animation, "new Animation")
      equal(animation.frames.length, 14, "frames in animation")
      equal(animation.index, 0, "start at frame 0")
      equal(animation.frame_duration, 100, "frameduration defaults to 100ms")
      equal(animation2.frames.length, 5, "animation.slice creates a new sub-animation")
      equal(animation3.frames.length, 2, "animation.slice creates a new sub-animation")
      same(animation3.frames[0].toString(), "[object HTMLCanvasElement]", "sub-animation contains canvas-elements")
      same(animation3.frame_duration, 100, "sub-animation gets frame_duration from parent")
      equal(animation.frames.length, 14, "after slice, frames in animation")
      equal(animation.frames[0], animation3.frames[0], "sub-animation contains same canvas-elements as parent")
      equal(animation.frames.length, animation.length, "animation.frames.length == animation.length")
    })
  }

  </script>

</head>

<body>
  <h1 id="qunit-header">Jaws test-suite</h1> 
  <h2 id="qunit-banner"></h2> 
  <div id="qunit-testrunner-toolbar"></div> 
  <h2 id="qunit-userAgent"></h2>
  <ol id="qunit-tests"></ol>
  <div id="qunit-fixture"></div>
</body>
</html>
